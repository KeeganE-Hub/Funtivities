<!DOCTYPE html>
<html>

<head>
    <style>
        #mycalendar {
            height: 94vh;
            width: 97vw;
        }

        #links {
            position: absolute;
            left: 5%;
            top: 38%;
        }

        #result {
            position: absolute;
            top: 40%;
            left: 5%;
        }
    </style>
</head>

<body class="yui3-skin-sam">
    <title>Funtivities</title>
    <div id="demo" class="yui3-skin-sam yui3-g">

        <div id="leftcolumn" class="yui3-u">
            <!-- Container for the calendar -->
            <div id="mycalendar"></div>
        </div>
        <div id="rightcolumn" class="yui3-u">
            <div id="links">
                Selected date: <span id="selecteddate"></span>
            </div>
            <h3 id="result"></h3>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/7.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.9.2/firebase-firestore.js"></script>
    <script src="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.js"></script>
    <script src="http://yui.yahooapis.com/3.18.1/build/yui/yui-min.js"></script>

    <script type="text/javascript">
        var firebaseConfig = {
            apiKey: "AIzaSyC9TTkmaZ5K32mGOSjniYSqMuLrzju0jts",
            authDomain: "funtivities-e4536.firebaseapp.com",
            databaseURL: "https://funtivities-e4536.firebaseio.com",
            projectId: "funtivities-e4536",
            storageBucket: "funtivities-e4536.appspot.com",
            messagingSenderId: "359469274628",
            appId: "1:359469274628:web:9733175c96f2ab8db98751"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        let eventDateArr = []
        let eventDateSepArr = []
        let month_arr = [];
        month_arr[0] = "January";
        month_arr[1] = "February";
        month_arr[2] = "March";
        month_arr[3] = "April";
        month_arr[4] = "May";
        month_arr[5] = "June";
        month_arr[6] = "July";
        month_arr[7] = "August";
        month_arr[8] = "September";
        month_arr[9] = "October";
        month_arr[10] = "November";
        month_arr[11] = "December";

        YUI().use('calendar', 'datatype-date', 'cssbutton', function (Y) {

            // Create a new instance of calendar, placing it in
            // #mycalendar container, setting its width to 500px,
            // the flags for showing previous and next month's
            // dates in available empty cells to true, and setting
            // the date to today's date.
            var calendar = new Y.Calendar({
                contentBox: "#mycalendar",
                width: '500px',
                showPrevMonth: false,
                showNextMonth: false,
                date: new Date()
            }).render();

            // Get a reference to Y.DataType.Date
            var dtdate = Y.DataType.Date;

            // Listen to calendar's selectionChange event.
            calendar.on("selectionChange", function (ev) {
                let first = true;
                let str = "";
                let result = document.getElementById("result");

                // Get the date from the list of selected
                // dates returned with the event (since only
                // single selection is enabled by default,
                // we expect there to be only one date)
                var newDate = ev.newSelection[0];

                // Format the date and output it to a DOM
                // element.
                Y.one("#selecteddate").setHTML(dtdate.format(newDate));
                readData();
                for (let i = 0; i < eventDateArr.length; i++) {
                    if (eventDateArr[i].eventDate == dtdate.format(newDate) && first){
                        first = false;
                        str = str + "Title: " + eventDateArr[i].title + "<br>"
                            + "Participants: " + eventDateArr[i].name + "<br>"
                            + "Place: " + eventDateArr[i].place + "<br>"
                            + "Time: " + eventDateArr[i].fullEvenDate + "<br>";
                    }
                }
                result.innerHTML = str;
            });
        });

        function readData() {
            db.collection("events").onSnapshot(function (querySnapshot) {
                querySnapshot.forEach(function (doc) {
                    let d = doc.data().time.toDate();
                    let theYear = d.getFullYear().toString();
                    let theMonth = parseInt(d.getMonth() + 1).toString();
                    let theMonthIndex = d.getMonth();
                    let theDay = d.getDate().toString();

                    eventDateSepArr.push({
                        year: theYear,
                        month: theMonth,
                        monthIndex: theMonthIndex,
                        day: theDay
                    });

                    if (theMonth.toString().length == 1) {
                        theMonth = 0 + theMonth.toString();
                    }

                    if (theDay.toString().length == 1) {
                        theDay = 0 + theDay.toString();
                    }

                    let theEventDate = theYear + "-" + theMonth + "-" + theDay;

                    eventDateArr.push({
                        eventDate: theEventDate,
                        fullEvenDate: d.toString(),
                        name: "Arash",
                        place: doc.data().place,
                        title: doc.data().title
                    });
                });
            });
        }
        readData();

        function color() {
            td = document.getElementsByTagName("td");
            div = document.getElementsByTagName("div");

            for(let i = 0; i < td.length; i++) {
                td[i].style.color = "black";
            }

            for (let i = 0; i < td.length; i++) {
                for (let j = 0; j < eventDateSepArr.length; j++) {
                    if (td[i].textContent == eventDateSepArr[j].day &&
                        div[5].textContent == (month_arr[eventDateSepArr[j].monthIndex]) + " " + eventDateSepArr[j].year) {
                        td[i].style.color = "red";
                    }
                }
            }
        }
        color();

        setInterval(function () {
            color();
        }, 1000);
    </script>
</body>

</html>